# MM/docker/nginx/mm.conf
# ─────────────────────────────────────────────────────────────────────────────
# Назначение: конфиг nginx для проксирования на gunicorn (unix socket) и раздачи статики/медиа
# ─────────────────────────────────────────────────────────────────────────────

server {
    listen 80;                                   # слушаем 80 порт
    server_name _;                               # принимаем любой хост

    client_max_body_size 50m;                    # допустимый размер запроса (на загрузки)

    # Статика
    location /static/ {
        alias /app/staticfiles/;                 # Django collectstatic складывает сюда
        access_log off;                          # логи по статике можно отключить
        expires 30d;                             # кеш для статики
    }

    # Медиа
    location /media/ {
        alias /app/media/;                       # медиа файлы
        access_log off;
        expires 7d;
    }

    # Аппликация Django через gunicorn unix-socket
    location / {
        include /etc/nginx/proxy_params;         # стандартные прокси-заголовки
        proxy_read_timeout 300;                  # таймаут чтения ответа
        proxy_connect_timeout 300;               # таймаут соединения
        proxy_pass http://unix:/run/gunicorn/gunicorn.sock;  # путь до сокета
    }
}
